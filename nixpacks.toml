# Configuração Otimizada para Railway/Nixpacks (Python + Venv)
# Resolve erros de PEP 668, pip not found e bibliotecas C++
# Usa wheels manylinux para pandas/numpy (sem compilação)

[phases.setup]
nixPkgs = [
    "python311",
    "python311Packages.pip",
    "postgresql_16",
    "stdenv.cc.cc.lib",
    "zlib",
    "libjpeg",
    "freetype",
    "lcms2",
    "libwebp",
    "libtiff",
    "openblas"
]

[phases.install]
cmds = [
    "python3 -m venv .venv",
    ". .venv/bin/activate && pip install --upgrade pip setuptools wheel",
    ". .venv/bin/activate && pip install --only-binary=:all: --no-cache-dir \"pandas==2.1.4\" \"numpy==1.26.4\" \"openpyxl==3.1.5\" || pip install --no-cache-dir \"pandas==2.1.4\" \"numpy==1.26.4\" \"openpyxl==3.1.5\"",
    ". .venv/bin/activate && pip install --no-cache-dir -r requirements.txt"
]

[phases.build]
dependsOn = ["install"]
cmds = [". .venv/bin/activate && python init_railway.py"]

[start]
cmd = "ls -la /app && chmod +x /app/startup.sh && /app/startup.sh"
